<!DOCTYPE html>
<html lang=en>
<head>
	<meta charset=utf-8>
	<title>2D Instantiate</title>
	<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.min.js"></script>
	<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/loaders/MTLLoader.js"></script>
	<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/examples/js/loaders/OBJLoader.js"></script>
	<script src="https://altspacevr.github.io/AltspaceSDK/dist/altspace.js"></script>
	<!-- <script src="../../dist/altspace.js"></script> -->
</head>
<body></body>
<script>
	var sim;
	var connection;
	var sceneSync;
	var objFileURL = "https://cmdrflexo.github.io/A-Frame_Flexo-180620-01/Scene/Grid%20Objects/10m_marble_cube.obj";
	var mtlFileURL = "https://cmdrflexo.github.io/A-Frame_Flexo-180620-01/Scene/Grid%20Objects/10m_marble_cube%20-%202K.mtl";
	var boxModel;

	var size = 10;
	var sceneObjects = SceneObject[size, size];

	function connect(connection) {
		this.connection = connection;
		sim = new altspace.utilities.Simulation();
		loadModel();
	}

	function loadModel() {
		var loader = new altspace.utilities.shims.OBJMTLLoader();
		loader.load(
			objFileURL, mtlFileURL,
			function(obj) {
				boxModel = obj;
				modelReady();
			}
		);
	}

	function createBox(pos) {
		var box = boxModel.clone();
		box.addBehaviors(
			new altspace.utilities.behaviors.Object3DSync(
				{ position : true, rotation : true, scale : true }
			)
		);
		box.name = "BOX(" + pos.x + ", " + pos.z + ")";
		box.position.set(pos.x, 0, pos.z);
		sim.scene.add(box);
		return box;
	}

	function modelReady() {
		sceneSync = new altspace.utilities.behaviors.SceneSync(
			connection.instance,
			{
				instantiators : { "Box" : createBoxes },
				ready : ready
			}
		);
	}

	function ready() {
		var x, z;
		for(z = 0; z < 10; z++)
			for(x = 0; x < 10; x++) { 
				var box = sceneSync.instantiate("Box", {x : x, z : z});
			}
		
	}

		
	var config = { authorId : "Flexo", appId : "2d_instantiate" };
	altspace.utilities.sync.connect(config).then(connect());

</script>
</html>
